<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/vega@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@3"></script>

    <title>Vega-Lite Chart</title>
</head>
<body>
<div>
    <div id="viz"></div>
    <p>
        This chart shows how the median population value changed from 1989 till 2018.<br>
        <br>
        It's an interactive plot, so you can see the median value on different parts of the lines, just hover it.
    </p>
</div>
</body>

<script>
    var chart = {
        "$schema": "https://vega.github.io/schema/vega-lite/v3.json",
        "width": 400,
        "height": 250,
        "data": {
            "url": "population_by_age_sex_year.csv"
        },
        "layer": [
            {
                "encoding": {
                    "x": {
                        "field": "year",
                        "type": "temporal",
                        "timeUnit": "year",
                        "title": "Year"
                    },
                    "y": {
                        "aggregate": "median",
                        "field": "population",
                        "type": "quantitative",
                        "scale": {
                            "domain": [
                                220000,
                                370000
                            ]
                        }
                    },
                    "color": {
                        "field": "sex",
                        "type": "nominal"
                    }
                },
                "layer": [
                    {
                        "mark": "line"
                    },
                    {
                        "selection": {
                            "label": {
                                "type": "single",
                                "nearest": true,
                                "on": "mouseover",
                                "encodings": [
                                    "x"
                                ],
                                "empty": "none"
                            }
                        },
                        "mark": "point",
                        "encoding": {
                            "opacity": {
                                "condition": {
                                    "selection": "label",
                                    "value": 1
                                },
                                "value": 0
                            }
                        }
                    }
                ]
            },
            {
                "transform": [
                    {
                        "filter": {
                            "selection": "label"
                        }
                    }
                ],
                "layer": [
                    {
                        "mark": {
                            "type": "rule",
                            "color": "gray"
                        },
                        "encoding": {
                            "x": {
                                "field": "year",
                                "type": "temporal"
                            }
                        }
                    },
                    {
                        "encoding": {
                            "text": {
                                "aggregate": "median",
                                "type": "quantitative",
                                "field": "population"
                            },
                            "x": {
                                "type": "temporal",
                                "field": "year"
                            },
                            "y": {
                                "aggregate": "median",
                                "type": "quantitative",
                                "field": "population"
                            }
                        },
                        "layer": [
                            {
                                "mark": {
                                    "type": "text",
                                    "align": "left",
                                    "dx": 5,
                                    "dy": -5
                                },
                                "encoding": {
                                    "fill": {
                                        "type": "nominal",
                                        "field": "sex"
                                    }
                                }
                            }
                        ]
                    }
                ]
            }
        ]
    };

    var opts = {
        "actions": false
    };

    vegaEmbed('#viz', chart, opts)
</script>
</html>